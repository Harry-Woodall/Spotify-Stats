import{t as j,r as s,b as _,z as h,D as k,a0 as x,a7 as C,a9 as W,aa as D,a,P as H,f as q,ao as A}from"./index.41bbef0a.js";import{I as L,m as U,M as m}from"./transition.af9024cf.js";import{V as $}from"./VResponsive.d7797cba.js";import{a as G}from"./tag.fd07c7c5.js";const Y=j()({name:"VImg",directives:{intersect:L},props:{aspectRatio:[String,Number],alt:String,cover:Boolean,eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},srcset:String,width:[String,Number],...U()},emits:{loadstart:e=>!0,load:e=>!0,error:e=>!0},setup(e,B){let{emit:f,slots:u}=B;const y=s(""),n=s(),l=s(e.eager?"loading":"idle"),o=s(),d=s(),i=_(()=>e.src&&typeof e.src=="object"?{src:e.src.src,srcset:e.srcset||e.src.srcset,lazySrc:e.lazySrc||e.src.lazySrc,aspect:Number(e.aspectRatio||e.src.aspect||0)}:{src:e.src,srcset:e.srcset,lazySrc:e.lazySrc,aspect:Number(e.aspectRatio||0)}),v=_(()=>i.value.aspect||o.value/d.value||0);h(()=>e.src,()=>{S(l.value!=="idle")}),h(v,(t,r)=>{!t&&r&&n.value&&g(n.value)}),k(()=>S());function S(t){if(!(e.eager&&t)&&!(x&&!t&&!e.eager)){if(l.value="loading",i.value.lazySrc){const r=new Image;r.src=i.value.lazySrc,g(r,null)}!i.value.src||C(()=>{var r,c;if(f("loadstart",((r=n.value)==null?void 0:r.currentSrc)||i.value.src),(c=n.value)!=null&&c.complete){if(n.value.naturalWidth||b(),l.value==="error")return;v.value||g(n.value,null),z()}else v.value||g(n.value),w()})}}function z(){var t;w(),l.value="loaded",f("load",((t=n.value)==null?void 0:t.currentSrc)||i.value.src)}function b(){var t;l.value="error",f("error",((t=n.value)==null?void 0:t.currentSrc)||i.value.src)}function w(){const t=n.value;t&&(y.value=t.currentSrc||t.src)}let I=-1;function g(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const c=()=>{clearTimeout(I);const{naturalHeight:N,naturalWidth:V}=t;N||V?(o.value=V,d.value=N):!t.complete&&l.value==="loading"&&r!=null?I=window.setTimeout(c,r):(t.currentSrc.endsWith(".svg")||t.currentSrc.startsWith("data:image/svg+xml"))&&(o.value=1,d.value=1)};c()}const R=_(()=>({"v-img__img--cover":e.cover,"v-img__img--contain":!e.cover})),E=()=>{var c;if(!i.value.src||l.value==="idle")return null;const t=a("img",{class:["v-img__img",R.value],src:i.value.src,srcset:i.value.srcset,alt:"",sizes:e.sizes,ref:n,onLoad:z,onError:b},null),r=(c=u.sources)==null?void 0:c.call(u);return a(m,{transition:e.transition,appear:!0},{default:()=>[W(r?a("picture",{class:"v-img__picture"},[r,t]):t,[[A,l.value==="loaded"]])]})},F=()=>a(m,{transition:e.transition},{default:()=>[i.value.lazySrc&&l.value!=="loaded"&&a("img",{class:["v-img__img","v-img__img--preload",R.value],src:i.value.lazySrc,alt:""},null)]}),M=()=>u.placeholder?a(m,{transition:e.transition,appear:!0},{default:()=>[(l.value==="loading"||l.value==="error"&&!u.error)&&a("div",{class:"v-img__placeholder"},[u.placeholder()])]}):null,O=()=>u.error?a(m,{transition:e.transition,appear:!0},{default:()=>[l.value==="error"&&a("div",{class:"v-img__error"},[u.error()])]}):null,P=()=>e.gradient?a("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${e.gradient})`}},null):null,T=s(!1);{const t=h(v,r=>{r&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{T.value=!0})}),t())})}return G(()=>W(a($,{class:["v-img",{"v-img--booting":!T.value}],style:{width:q(e.width==="auto"?o.value:e.width)},aspectRatio:v.value,"aria-label":e.alt,role:e.alt?"img":void 0},{additional:()=>a(H,null,[a(E,null,null),a(F,null,null),a(P,null,null),a(M,null,null),a(O,null,null)]),default:u.default}),[[D("intersect"),{handler:S,options:e.options},null,{once:!0}]])),{currentSrc:y,image:n,state:l,naturalWidth:o,naturalHeight:d}}});export{Y as V};
